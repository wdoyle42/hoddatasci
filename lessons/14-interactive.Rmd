---
title: "Interactive Graphics"
author: "Will Doyle
date: `r Sys.Date() `
---


```{r}
library(tidyverse)
library(tidycensus)
library(sf)
library(plotly)
```

```{r}

my_acs_key<-readLines("~/hod_datasci_keys/my_acs_key.txt",warn = FALSE)

acs_key<-my_acs_key

# Or just paste it here.
#acs_key<-"<your_acs_key_here>"

census_api_key(acs_key)

#v19 <- load_variables(2019, "acs5", cache = TRUE)

View(v19)

var_list<-paste0("B15002_",c("001",
                            "015",
                            "016",
                            "017",
                            "018",
                            "032",
                            "033",
                            "034",
                            "035"))

educ<-get_acs(geography="state",
                variables=var_list,
                output="wide",
                geometry=TRUE,
              keep_geo_vars = TRUE,
              year = 2019
                )

names(educ)<-tolower(names(educ))

educ<-educ%>%
  rename(State=name.x)

educ<-
  educ%>%
  group_by(State)%>%
  mutate(college_educ=((b15002_015e+
                         b15002_016e+
                         b15002_017e+
                         b15002_018e+
                         b15002_032e+
                         b15002_033e+
                         b15002_034e+
                         b15002_035e)/b15002_001e)*100)%>%
  select(State,college_educ,geometry)


```


```{r}

var_list<-paste0("B19001_",c("001",
                             "013",
                             "014",
                            "015",
                            "016",
                            "017"
                            ))

income<-get_acs(geography="state",
                variables=var_list,
                output="wide",
              year = 2019)

names(income)<-tolower(names(income))

income<-income%>%
  rename(State=name)

income<-income %>%
group_by(State) %>%
  mutate(
    income_75 = ((
      b19001_013e +
        b19001_014e +
        b19001_015e +
        b19001_016e +
        b19001_017e 
    ) / b19001_001e)*100
  )%>%
  select(State,income_75)


```

```{r}
df<-educ%>%
  as_tibble()%>%
  left_join(income,by="State")
```

```{r}
df%>%
  select(State,college_educ,income_75)%>%
  mutate(`Pct w/ Bachelor's`=college_educ)%>%
  mutate(`Pct w/ Income>75k`=income_75)%>%
  select(-income_75,-college_educ)%>%
  mutate(State=fct_reorder(as_factor(State),`Pct w/ Bachelor's`))%>%
  ggplot(aes(x=State,
             y=`Pct w/ Bachelor's`,
             fill=`Pct w/ Bachelor's`,
             text=paste0(
               State,": ", round(`Pct w/ Bachelor's`,1)) 
                   ) )+
  geom_col()+
  scale_fill_fermenter(palette="YlGnBu")+
  coord_flip()+
  theme_minimal()->gg

ggplotly(gg,tooltip="text")
  
```

```{r}
df%>%
  select(State,college_educ,income_75)%>%
  mutate(`Pct w/ Bachelor's`=college_educ)%>%
  mutate(`Pct w/ Income>75k`=income_75)%>%
  select(-income_75,-college_educ)%>%
  ggplot(aes(y=`Pct w/ Income>75k`,
             x=`Pct w/ Bachelor's`,
             text=paste0(
               State,": ", 
               "<br>",
               "Pct w/ Bachelor's: ",
               round(`Pct w/ Bachelor's`,1) ,
               "<br>",
               "Pct w/ Income >75k: ",
               round(`Pct w/ Income>75k`,1)
                   )))+
  geom_point()+
  scale_fill_gradient()+
  theme_minimal()+
  theme(legend.position = "none")->gg

ggplotly(gg,tooltip="text")
  
```

